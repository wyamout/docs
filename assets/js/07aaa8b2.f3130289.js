"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[9732],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||s;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=r.length,i=new Array(s);i[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var u=2;u<s;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5162:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(7294),a=r(6010);const s="tabItem_Ymn6";function i(e){let{children:t,hidden:r,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,a.Z)(s,i),hidden:r},t)}},4866:(e,t,r)=>{r.d(t,{Z:()=>x});var n=r(7462),a=r(7294),s=r(6010),i=r(2466),o=r(6775),l=r(1980),u=r(7392),c=r(12);function p(e){return function(e){return a.Children.map(e,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:r,attributes:n,default:a}}=e;return{value:t,label:r,attributes:n,default:a}}))}function d(e){const{values:t,children:r}=e;return(0,a.useMemo)((()=>{const e=t??p(r);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function m(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:r}=e;const n=(0,o.k6)(),s=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,l._X)(s),(0,a.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})}),[s,n])]}function g(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,s=d(e),[i,o]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s}))),[l,u]=h({queryString:r,groupId:n}),[p,g]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,s]=(0,c.Nk)(r);return[n,(0,a.useCallback)((e=>{r&&s.set(e)}),[r,s])]}({groupId:n}),b=(()=>{const e=l??p;return m({value:e,tabValues:s})?e:null})();(0,a.useEffect)((()=>{b&&o(b)}),[b]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),g(e)}),[u,g,s]),tabValues:s}}var b=r(2389);const f="tabList__CuJ",v="tabItem_LNqP";function w(e){let{className:t,block:r,selectedValue:o,selectValue:l,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),d=e=>{const t=e.currentTarget,r=c.indexOf(t),n=u[r].value;n!==o&&(p(t),l(n))},m=e=>{var t;let r=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;r=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;r=c[t]??c[c.length-1];break}}null==(t=r)||t.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":r},t)},u.map((e=>{let{value:t,label:r,attributes:i}=e;return a.createElement("li",(0,n.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},i,{className:(0,s.Z)("tabs__item",v,null==i?void 0:i.className,{"tabs__item--active":o===t})}),r??t)})))}function y(e){let{lazy:t,children:r,selectedValue:n}=e;if(t){const e=r.find((e=>e.props.value===n));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function k(e){const t=g(e);return a.createElement("div",{className:(0,s.Z)("tabs-container",f)},a.createElement(w,(0,n.Z)({},e,t)),a.createElement(y,(0,n.Z)({},e,t)))}function x(e){const t=(0,b.Z)();return a.createElement(k,(0,n.Z)({key:String(t)},e))}},6798:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>u,toc:()=>p});var n=r(7462),a=(r(7294),r(3905)),s=r(4866),i=r(5162);const o={sidebar_label:"Sign arbitrary messages",sidebar_position:5},l="Sign arbitrary messages",u={unversionedId:"guides/browser-extension/sign-arbitrary-messages",id:"guides/browser-extension/sign-arbitrary-messages",title:"Sign arbitrary messages",description:"If you want to authenticate a user, please refer to the Sign-In with Ethereum page.",source:"@site/docs/guides/browser-extension/sign-arbitrary-messages.md",sourceDirName:"guides/browser-extension",slug:"/guides/browser-extension/sign-arbitrary-messages",permalink:"/guides/browser-extension/sign-arbitrary-messages",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/guides/browser-extension/sign-arbitrary-messages.md",tags:[],version:"current",lastUpdatedAt:1666618247,formattedLastUpdatedAt:"Oct 24, 2022",sidebarPosition:5,frontMatter:{sidebar_label:"Sign arbitrary messages",sidebar_position:5},sidebar:"guidesSidebar",previous:{title:"Sign-In with Ethereum",permalink:"/guides/browser-extension/sign-in-with-ethereum"},next:{title:"Grant Permissions to 3rd parties",permalink:"/guides/key-manager/give-permissions"}},c={},p=[{value:"1. Initialize a blockchain provider",id:"1-initialize-a-blockchain-provider",level:2},{value:"2. Get the Universal Profile address",id:"2-get-the-universal-profile-address",level:2},{value:"3. Sign the message",id:"3-sign-the-message",level:2},{value:"4. Verify the signature",id:"4-verify-the-signature",level:2}],d={toc:p};function m(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"sign-arbitrary-messages"},"Sign arbitrary messages"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"If you want to authenticate a user, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"/guides/browser-extension/sign-in-with-ethereum"},"Sign-In with Ethereum")," page.")),(0,a.kt)("p",null,"This article explains how to request a signature from the ",(0,a.kt)("a",{parentName:"p",href:"/guides/browser-extension/install-browser-extension"},"LUKSO browser extension"),"."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"/img/extension/lukso-extension-sign.webp",alt:"Example of Sign-In with Ethereum screen"})),(0,a.kt)("h2",{id:"1-initialize-a-blockchain-provider"},"1. Initialize a blockchain provider"),(0,a.kt)("p",null,"The browser extension injects a global API into the website that is visited. This API is available under ",(0,a.kt)("inlineCode",{parentName:"p"},"window.ethereum"),". You can use this object to initialise your ",(0,a.kt)("a",{parentName:"p",href:"https://web3js.readthedocs.io/en/v1.8.0/"},"web3.js")," or ",(0,a.kt)("a",{parentName:"p",href:"https://docs.ethers.io/v5/"},"Ethers.js")," library."),(0,a.kt)(s.Z,{groupId:"provider",mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"ethers",label:"Ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { ethers } from 'ethers';\n\nconst etherProvider = new ethers.providers.Web3Provider(window.ethereum);\n"))),(0,a.kt)(i.Z,{value:"web3",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import Web3 from 'web3';\n\nconst web3 = new Web3(window.ethereum);\n")))),(0,a.kt)("h2",{id:"2-get-the-universal-profile-address"},"2. Get the Universal Profile address"),(0,a.kt)("p",null,"A call to ",(0,a.kt)("inlineCode",{parentName:"p"},"requestAccounts")," will open the extension popup and prompt the user to select her or his Universal Profile to interact with your Dapp. The LUKSO browser extension will send the Universal Profile address back to your Dapp (which is the address of the ",(0,a.kt)("a",{parentName:"p",href:"/standards/universal-profile/lsp0-erc725account"},(0,a.kt)("inlineCode",{parentName:"a"},"LSP0 - ERC725 Account"))," smart contract)."),(0,a.kt)(s.Z,{groupId:"provider",mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"ethers",label:"Ethers.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const accountsRequest = await etherProvider.send('eth_requestAccounts', []);\nconst signer = etherProvider.getSigner();\nconst upAddress = await signer.getAddress();\n// 0x3E39275Ed3B370E074534edeE13a166512AD32aB\n"))),(0,a.kt)(i.Z,{value:"web3",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const accountsRequest = await web3.eth.requestAccounts();\nconst accounts = await web3.eth.getAccounts();\nconst upAddress = accounts[0];\n// 0x3E39275Ed3B370E074534edeE13a166512AD32aB\n"))),(0,a.kt)(i.Z,{value:"raw",label:"raw",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const accountsRequest = await window.ethereum.request({\n  method: 'eth_requestAccounts',\n  params: [],\n});\nconst accounts = await window.ethereum.request({\n  method: 'eth_accounts',\n  params: [],\n});\n\nconst upAddress = accounts[0];\n")))),(0,a.kt)("h2",{id:"3-sign-the-message"},"3. Sign the message"),(0,a.kt)("p",null,"Once you have access to the Universal Profile address, you can request a signature. The browser extension will sign the message with the controller key used by the extension (a smart contract can't sign)."),(0,a.kt)(s.Z,{groupId:"provider",mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"ethers",label:"Ethers.js",mdxType:"TabItem"},(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"When calling Ethers.js ",(0,a.kt)("a",{parentName:"p",href:"https://docs.ethers.io/v5/api/signer/#Signer-signMessage"},(0,a.kt)("inlineCode",{parentName:"a"},"signer.signMessage( message )")),", it uses ",(0,a.kt)("inlineCode",{parentName:"p"},"personal_sign")," RPC call under the hood. However, our extension only supports the latest version of ",(0,a.kt)("a",{parentName:"p",href:"https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_sign"},(0,a.kt)("inlineCode",{parentName:"a"},"eth_sign")),". Therefore, you need to use ",(0,a.kt)("inlineCode",{parentName:"p"},'provider.send("eth_sign", [upAddress, message])')," instead."),(0,a.kt)("p",{parentName:"admonition"},"You can get more information ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/MetaMask/metamask-extension/issues/15857"},"here")," and ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ethers-io/ethers.js/issues/1544"},"here"),".")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const message = 'Please sign this message \ud83d\ude0a';\nconst signature = await etherProvider.send('eth_sign', [upAddress, message]);\n// 0x38c53...\n"))),(0,a.kt)(i.Z,{value:"web3",label:"web3.js",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const message = 'Please sign this message \ud83d\ude0a';\nconst signature = await web3.eth.sign(message, upAddress);\n// 0x38c53...\n")))),(0,a.kt)("h2",{id:"4-verify-the-signature"},"4. Verify the signature"),(0,a.kt)("p",null,"Your Dapp has now received a message signed by the controller address of the Universal Profile. To finalise the login, you need to verify if the message was signed by an address which has the ",(0,a.kt)("inlineCode",{parentName:"p"},"SIGN")," permission for this Universal Profile."),(0,a.kt)("p",null,"The verification process is the same as for ",(0,a.kt)("a",{parentName:"p",href:"/guides/browser-extension/sign-in-with-ethereum#4-verify-the-signature"},"Sign-In with Ethereum"),", you can check how it is done there."))}m.isMDXComponent=!0}}]);