"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[3274],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return f}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(n),f=r,m=u["".concat(c,".").concat(f)]||u[f]||p[f]||o;return n?a.createElement(m,i(i({ref:t},d),{},{components:n})):a.createElement(m,i({ref:t},d))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4231:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return d},default:function(){return u}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],s={id:"execute-transaction",title:"Execute Transaction",sidebar_position:1},c=void 0,l={unversionedId:"tools/relayer-api/execute-transaction",id:"tools/relayer-api/execute-transaction",isDocsHomePage:!1,title:"Execute Transaction",description:"To execute a transaction on behalf of a Universal Profile:",source:"@site/docs/tools/relayer-api/execute-transaction.md",sourceDirName:"tools/relayer-api",slug:"/tools/relayer-api/execute-transaction",permalink:"/tools/relayer-api/execute-transaction",editUrl:"https://github.com/lukso-network/docs/tree/main/docs/tools/relayer-api/execute-transaction.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"execute-transaction",title:"Execute Transaction",sidebar_position:1},sidebar:"toolsSidebar",previous:{title:"Fungible Token (LSP7)",permalink:"/tools/lsp-factoryjs/deployment/fungible-token"},next:{title:"ERC725 Tools",permalink:"/tools/erc725-tools"}},d=[{value:"Payload",id:"payload",children:[],level:3},{value:"Response",id:"response",children:[],level:3},{value:"Example",id:"example",children:[{value:"Sending LYX",id:"sending-lyx",children:[],level:3}],level:2}],p={toc:d};function u(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"To execute a transaction on behalf of a Universal Profile:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://img.shields.io/badge/-POST-green",alt:"post"})," ",(0,o.kt)("inlineCode",{parentName:"p"},"https://relayer.lukso.network/api/v1/execute")),(0,o.kt)("p",null,"Once your transaction has been sent to the relayer get the status of your transaction using:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://img.shields.io/badge/-GET-blue",alt:"get"})," ",(0,o.kt)("inlineCode",{parentName:"p"},"https://relayer.lukso.network/api/v1/task/{taskId}")),(0,o.kt)("h3",{id:"payload"},"Payload"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "keyManagerAddress": "0xBB645D97B0c7D101ca0d73131e521fe89B463BFD",\n    "transaction": {\n        "abi": "0x7f23690c5ef83ad9559033e6e941db7d7c495acdce616347d28e90c7ce47cbfcfcad3bc5000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000596f357c6aa5a21984a83b7eef4cb0720ac1fcf5a45e9d84c653d97b71bbe89b7a728c386a697066733a2f2f516d624b43744b4d7573376741524470617744687a32506a4e36616f64346b69794e436851726d3451437858454b00000000000000",\n        "signature": "0x43c958b1729586749169599d7e776f18afc6223c7da21107161477d291d497973b4fc50a724b1b2ab98f3f8cf1d5cdbbbdf3512e4fbfbdc39732229a15beb14a1b",\n        "nonce": 1\n    }\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"keyManagerAddress"),": the address of the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md"},(0,o.kt)("inlineCode",{parentName:"a"},"KeyManager"))," contract which controls the Universal Profile"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"abi"),": the encoded abi of the transaction"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"signature"),": the transaction signature "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"nonce"),": nonce of the KeyManager contract")),(0,o.kt)("h3",{id:"response"},"Response"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "success": true,\n    "taskId": "fb0a071d-c526-488d-9f17-b919507fddf2",\n    "keyManagerAddress": "0xBB645D97B0c7D101ca0d73131e521fe89B463BFD",\n    "transaction": {\n        "abi": "0x7f23690c5ef83ad9559033e6e941db7d7c495acdce616347d28e90c7ce47cbfcfcad3bc5000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000596f357c6aa5a21984a83b7eef4cb0720ac1fcf5a45e9d84c653d97b71bbe89b7a728c386a697066733a2f2f516d624b43744b4d7573376741524470617744687a32506a4e36616f64346b69794e436851726d3451437858454b00000000000000",\n        "signature": "0x43c958b1729586749169599d7e776f18afc6223c7da21107161477d291d497973b4fc50a724b1b2ab98f3f8cf1d5cdbbbdf3512e4fbfbdc39732229a15beb14a1b",\n        "nonce": 1\n    }\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"success"),": whether the transaction was successful"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"taskId"),": task id used to identify the transaction using the ",(0,o.kt)("inlineCode",{parentName:"li"},"/task/{taskId}")," endpoint"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"keyManagerAddress"),": the address of the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md"},(0,o.kt)("inlineCode",{parentName:"a"},"KeyManager"))," contract which controls the Universal Profile"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"abi"),": the encoded abi of the transaction you sent"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"signature"),": the transaction signature you sent"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"nonce"),": nonce of the KeyManager contract you sent")),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("h3",{id:"sending-lyx"},"Sending LYX"),(0,o.kt)("p",null,"This example shows how to prepare a transaction for the relayer. The same logic can be applied to any transaction."),(0,o.kt)("p",null,"You will need the address of the UP making the transaction, and the private key of the account which controls the UP."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"const controllingAccountPrivateKey = '0x...'\nconst myUpAddress = '0x...'\n")),(0,o.kt)("p",null,"Then instantiate a Web3 ",(0,o.kt)("inlineCode",{parentName:"p"},"Contract")," object for your UP and KeyManager using the contract ABIs from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/universalprofile-smart-contracts"},(0,o.kt)("inlineCode",{parentName:"a"},"@lukso/universalprofile-smart-contracts"))," npm package"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import UniversalProfileContract from '@lukso/universalprofile-smart-contracts/artifacts/UniversalProfile.json';\nimport KeyManagerContract from '@lukso/universalprofile-smart-contracts/artifacts/LSP6KeyManager.json';\n\nconst myUniversalProfile = new web3.eth.Contract(UniversalProfileContract.abi, myUpAddress);\n\nconst keyManagerAddress = await myUniversalProfile.methods.owner().call();\nconst KeyManager = new web3.eth.Contract(KeyManagerContract.abi, keyManagerAddress);\n")),(0,o.kt)("p",null,"Get the nonce of the KeyManager:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"const controllerAccount = web3.eth.accounts.privateKeyToAccount(controllerPrivateKey);\nconst controllerAddress = controllerAccount.address;\n\nconst nonce = await KeyManager.methods.getNonce(controllerAddress, 0).call()\n")),(0,o.kt)("p",null,"Here we show how to transfer LYX from one UP to another, though this step will be different for different use cases."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Encode transaction ABI"',title:'"Encode',transaction:!0,'ABI"':!0},"const abiPayload = myUniversalProfile.methods.execute(\n    0, // The OPERATION_CALL value. 0 for a LYX transaction\n    '0x...', // Recipient address\n    web3.utils.toWei(amountInLyx.toString()), // ammount of LYX to send in wei\n    '0x' // Extra data to send. Here we dont have any so we set '0x' to indicate an empty value\n).encodeABI()) ;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Sign the transaction"',title:'"Sign',the:!0,'transaction"':!0},"const message = web3.utils.soliditySha3(\n    keyManagerAddress, nonce,\n    {\n        t: 'bytes',\n        v: abiPayload,\n    },\n);\n\nconst signatureObject = controllerAccount.sign(message);\nconst signature = signatureObject.signature;\n")),(0,o.kt)("p",null,"Now you have everything you need to send your transaction to the relayer for execution:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"const payload = {\n    keyManagerAddress,\n        transaction: {\n            abi: abiPayload,\n            signature,\n            nonce,\n    };,\n};\n\nconst response = await axios.post(`https://relayer.lukso.network/api/v1/execute`, payload);\n")),(0,o.kt)("p",null,"Check the status of your transaction using the returned ",(0,o.kt)("inlineCode",{parentName:"p"},"taskId")," at ",(0,o.kt)("inlineCode",{parentName:"p"},"/task/{taskId}"),". It will be marked as complete once it has been executed on the blockchain."))}u.isMDXComponent=!0}}]);